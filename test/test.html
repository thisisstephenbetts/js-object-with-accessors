<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="qunit-1.13.0.css">
	<script src='qunit-1.13.0.js'></script>
	<script src='../src/class.js'></script>
	<script src='../src/object_with_accessors.js'></script>
	<!-- <script src='http://influxenterprises.pathinonnu.local/j/lib/object_with_accessors.js'></script>
		<script src='http://influxenterprises.pathinonnu.local/j/vdr/jquery-1.7.1.min.js'></script> -->
	<script>
		ObjectWithAccessors.createSubclass('SubClass',{
			accessors: ['first','second','third'],
			instance_methods: {
				init: function(args) { this._super(args) }				
			}
		});
		// Adding another method
		SubClass.prototype.another = function() {
			return 'another method in class '+this.constructor.name
		}
		
		SubClass.createSubclass('SubSubClass',{
			accessors: ['fourth','fifth'],
			instance_methods: {
				init: function(args) { this._super(args) },
				second: function() { return 'Overridden (inherited) "second" method' },
				fifth: function() { return 'Overridden (new) "fifth" method' }
			},
		});

		// Overriding defined method
		SubSubClass.prototype.third = function() {
			return 'Externally overridden "third" method';
		}
		
		//Defining new method
		SubSubClass.prototype.extra_method = function() {
			return 'New method SubSubClass#extra_method'
		}
		
		var a = new SubClass;
		a.first('a 1st');
		a.second('a 2nd');

		var a2 = new SubClass({first: 'A', second: 'B', third: 'C'});

		test('a, instance of SubClass',function() {
			equal(a.first(),'a 1st');
			equal(a.second(),'a 2nd');
			equal(a.third(),undefined);
			throws(function() { a.fourth() },"TypeError: Object #<SubClass> has no method 'fourth'");
			equal(a.another(),'another method in class SubClass');
		})
		
		test('a2, another instance of SubClass',function() {
			equal(a2.first(),'A');
			equal(a2.second(),'B');
			equal(a2.third(),'C');
			throws(function() { a2.fourth() },"TypeError: Object #<SubClass> has no method 'fourth'");
			equal(a2.another(),'another method in class SubClass');
		});



		var b = new SubSubClass;
		b.first('b 1st');
		b.second('b 2nd');
		b.third('b 3rd');
		b.fourth('b 4th');
		b.fifth('b 5th');
		b.extra_method('b extra');
		
		var b2 = new SubSubClass({first: 'b2 first', second: 'b2 second', third: 'b2 third', fourth: 'b2 fourth', fifth: 'b 5th'});
		
		test('b, instance of SubSubClass',function() {
			equal(b.first(),'b 1st');
			equal(b.second(),'Overridden (inherited) "second" method');
			equal(b.third(),'Externally overridden "third" method');
			equal(b.fourth(),'b 4th');
			equal(b.fifth(),'Overridden (new) "fifth" method');
			equal(b.another(),'another method in class SubSubClass');
			equal(b.extra_method(),'New method SubSubClass#extra_method');
		});

		test('b2, another instance of SubSubClass',function() {
			equal(b2.first(),'b2 first');
			equal(b2.second(),'Overridden (inherited) "second" method');
			equal(b2.third(),'Externally overridden "third" method');
			equal(b2.fourth(),'b2 fourth');
			equal(b2.fifth(),'Overridden (new) "fifth" method');
			equal(b2.another(),'another method in class SubSubClass');
			equal(b2.extra_method(),'New method SubSubClass#extra_method');
		});

		test("a instanceof SubClass",function() {
			ok(a instanceof SubClass);
			equal(a.constructor._parent_class.name,ObjectWithAccessors.name);
		});


		test("a not instanceof SubSubClass",function() {
			ok(!(a instanceof SubSubClass));
		});

		test("b instanceof SubClass",function() {
			ok(b instanceof SubClass);
		});


		test("b instanceof SubSubClass",function() {
			ok(b instanceof SubSubClass);
			equal(b.constructor._parent_class.name,SubClass.name);
		});


		ObjectWithAccessors.createSubclass('ClassWithDefaults',{
			accessors: ['meth1','meth2'],
			default_params: {meth2: 'meth2 default'}
		});

		ClassWithDefaults.createSubclass('ClassWithDefaultsSubClass',{
			accessors: ['meth3','meth4'],
			default_params: {meth4: 'meth4 default'},
			instance_methods: {
			},
			class_methods: {
			}
		});

		var c = new ClassWithDefaults();
		var c2 = new ClassWithDefaults({meth1:'c2 meth1',meth2:'c2 meth2'});

		var d = new ClassWithDefaultsSubClass();
		var d2 = new ClassWithDefaultsSubClass({
			meth1:'d2 meth1',meth2:'d2 meth2',meth3:'d2 meth3',meth4:'d2 meth4'
		});
		
		test('c, instance of ClassWithDefaults',function() {
			equal(c.meth1(),undefined);
			equal(c.meth2(),'meth2 default');
		});

		test('c2, another instance of ClassWithDefaults, created with params',function() {
			equal(c2.meth1(),'c2 meth1');
			equal(c2.meth2(),'c2 meth2');
		});
		
		test('d, instance of ClassWithDefaultsSubClass',function() {
			equal(d.meth1(),undefined);
			equal(d.meth2(),'meth2 default');
			equal(d.meth3(),undefined);
			equal(d.meth4(),'meth4 default');
		});

		test('d2, another instance of ClassWithDefaultsSubClass, created with params',function() {
			equal(d2.meth1(),'d2 meth1');
			equal(d2.meth2(),'d2 meth2');
			equal(d2.meth3(),'d2 meth3');
			equal(d2.meth4(),'d2 meth4');
		});
		
		ObjectWithAccessors.createSubclass('ClassWithClassMethod',{
			class_methods: {
				cmethod: function() { return "ClassWithClassMethod#cmethod" }
			}
		});

		ClassWithClassMethod.createSubclass('SubClassWithClassMethod',{});

		var e = new ClassWithClassMethod();
		var f = new SubClassWithClassMethod();
		
		test('Testing ClassWithClassMethod',function() {
			equal(ClassWithClassMethod.cmethod(),'ClassWithClassMethod#cmethod');
			equal(e.constructor.cmethod(),'ClassWithClassMethod#cmethod');
		});

		test('Testing SubClassWithClassMethod (inheritance from ClassWithClassMethod)',function() {
			equal(SubClassWithClassMethod.cmethod(),'ClassWithClassMethod#cmethod');
			equal(f.constructor.cmethod(),'ClassWithClassMethod#cmethod');
		});

		ObjectWithAccessors.createSubclass('Base',{
			instance_methods: {
				instance_method: function() { return 'Base#instance_method'; }
			},
			class_methods: {
				class_method: function() { return 'Base#class_method'; }
			}
		});
		
		Base.createSubclass('BaseSubClassUsingSuper',{
			instance_methods: {
				instance_method: function() { 
					return "BaseSubClassUsingSuper#instance_method (incorporating "+this._super()+")"
					}
			},
			class_methods: {
				class_method: function() {
					return "BaseSubClassUsingSuper#class_method (incorporating "+this._super()+")"
				}
			}
		});
		
		var g = new Base();
		var h = new BaseSubClassUsingSuper();

		test('Testing Base',function() {
			equal(g.instance_method(),'Base#instance_method');
			equal(Base.class_method(),'Base#class_method');
			equal(g.constructor.class_method(),'Base#class_method');
		});

		test('Testing Base',function() {
			equal(h.instance_method(),'BaseSubClassUsingSuper#instance_method (incorporating Base#instance_method)');
			equal(BaseSubClassUsingSuper.class_method(),
					'BaseSubClassUsingSuper#class_method (incorporating Base#class_method)');
			equal(h.constructor.class_method(),'BaseSubClassUsingSuper#class_method (incorporating Base#class_method)');
		});
		


	</script>
</head>
<body>
	<div id="qunit"></div>
</body>	
</html>
